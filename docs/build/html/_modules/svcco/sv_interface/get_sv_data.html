
<!DOCTYPE html>

<html lang="python">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>svcco.sv_interface.get_sv_data &#8212; SVCCO 0.5.52 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SVCCO 0.5.52 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">svcco.sv_interface.get_sv_data</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for svcco.sv_interface.get_sv_data</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">splprep</span><span class="p">,</span> <span class="n">splev</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span><span class="p">,</span> <span class="n">proj3d</span><span class="p">,</span> <span class="n">art3d</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.art3d</span> <span class="kn">import</span> <span class="n">Line3DCollection</span>
<span class="kn">import</span> <span class="nn">vtk</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">pyvista</span> <span class="k">as</span> <span class="nn">pv</span>

<span class="kn">from</span> <span class="nn">..branch_addition.basis</span> <span class="kn">import</span> <span class="n">tangent_basis</span>

<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">art3d</span>

<div class="viewcode-block" id="rotation_matrix"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.rotation_matrix">[docs]</a><span class="k">def</span> <span class="nf">rotation_matrix</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates a rotation matrix given a vector d. The direction of d</span>
<span class="sd">    corresponds to the rotation axis. The length of d corresponds to</span>
<span class="sd">    the sin of the angle of rotation.</span>

<span class="sd">    Variant of: http://mail.scipy.org/pipermail/numpy-discussion/2009-March/040806.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sin_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sin_angle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">/=</span> <span class="n">sin_angle</span>

    <span class="n">eye</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ddt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="n">skew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>    <span class="mi">0</span><span class="p">,</span>  <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>  <span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                  <span class="p">[</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>     <span class="mi">0</span><span class="p">,</span>  <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>    <span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">ddt</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sin_angle</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eye</span> <span class="o">-</span> <span class="n">ddt</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin_angle</span> <span class="o">*</span> <span class="n">skew</span>
    <span class="k">return</span> <span class="n">M</span></div>

<div class="viewcode-block" id="pathpatch_2d_to_3d"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.pathpatch_2d_to_3d">[docs]</a><span class="k">def</span> <span class="nf">pathpatch_2d_to_3d</span><span class="p">(</span><span class="n">pathpatch</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">normal</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms a 2D Patch to a 3D patch using the given normal vector.</span>

<span class="sd">    The patch is projected into they XY plane, rotated about the origin</span>
<span class="sd">    and finally translated by z.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span> <span class="c1">#Translate strings to normal vectors</span>
        <span class="n">index</span> <span class="o">=</span> <span class="s2">&quot;xyz&quot;</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">index</span><span class="p">)</span>

    <span class="n">normal</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span> <span class="c1">#Make sure the vector is normalised</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">pathpatch</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span> <span class="c1">#Get the path and the associated transform</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">pathpatch</span><span class="o">.</span><span class="n">get_patch_transform</span><span class="p">()</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">transform_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="c1">#Apply the transform</span>

    <span class="n">pathpatch</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">art3d</span><span class="o">.</span><span class="n">PathPatch3D</span> <span class="c1">#Change the class</span>
    <span class="n">pathpatch</span><span class="o">.</span><span class="n">_code3d</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">codes</span> <span class="c1">#Copy the codes</span>
    <span class="n">pathpatch</span><span class="o">.</span><span class="n">_facecolor3d</span> <span class="o">=</span> <span class="n">pathpatch</span><span class="o">.</span><span class="n">get_facecolor</span> <span class="c1">#Get the face color</span>

    <span class="n">verts</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span> <span class="c1">#Get the vertices in 2D</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="c1">#Obtain the rotation vector</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">rotation_matrix</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="c1">#Get the rotation matrix</span>

    <span class="n">pathpatch</span><span class="o">.</span><span class="n">_segment3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">verts</span><span class="p">])</span></div>

<div class="viewcode-block" id="pathpatch_translate"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.pathpatch_translate">[docs]</a><span class="k">def</span> <span class="nf">pathpatch_translate</span><span class="p">(</span><span class="n">pathpatch</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translates the 3D pathpatch by the amount delta.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pathpatch</span><span class="o">.</span><span class="n">_segment3d</span> <span class="o">+=</span> <span class="n">delta</span></div>

<div class="viewcode-block" id="get_longest_path"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.get_longest_path">[docs]</a><span class="k">def</span> <span class="nf">get_longest_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">seed_edge</span><span class="p">):</span>
    <span class="n">dig</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">temp_edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">seed_edge</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">dig</span><span class="p">:</span>
        <span class="n">keep_digging</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">temp_edges</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">15</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">temp_edges</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">15</span><span class="p">])])</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">16</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">temp_edges</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">16</span><span class="p">])])</span>
                <span class="n">temp_edges</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
                <span class="n">keep_digging</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">keep_digging</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">dig</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">keep_digging</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_edges</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">temp_edges</span>
    <span class="n">edge_depths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">temp_edges</span><span class="p">:</span>
        <span class="n">edge_depths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">26</span><span class="p">])</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">edge_depths</span><span class="p">)</span>
    <span class="n">max_edge_depths</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edge_depths</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">max_depth</span><span class="p">]</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[[</span><span class="n">temp_edges</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">max_edge_depths</span><span class="p">]</span>
    <span class="n">path_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">20</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
    <span class="n">retrace</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">retrace</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">retrace</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">17</span><span class="p">]))</span>
                <span class="n">path_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">20</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">seed_edge</span><span class="p">:</span>
                    <span class="n">retrace</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">paths</span><span class="p">[</span><span class="n">path_lengths</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">path_lengths</span><span class="p">))]</span></div>

<div class="viewcode-block" id="get_alternate_path"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.get_alternate_path">[docs]</a><span class="k">def</span> <span class="nf">get_alternate_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">seed_edge</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1">#print(&#39;reference: {}&#39;.format(reference))</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">get_longest_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">seed_edge</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">seed_edge_idx</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">seed_edge</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">seed_edge_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Seed edge is terminal and no alternative is &#39;</span><span class="o">+</span>
              <span class="s1">&#39;possible. </span><span class="se">\n</span><span class="s1"> Computation finished.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">seed_edge</span><span class="p">,</span><span class="mi">15</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">seed_edge</span><span class="p">,</span><span class="mi">16</span><span class="p">])]</span>
        <span class="k">if</span> <span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reference</span><span class="p">:</span>
            <span class="n">alternate_path</span> <span class="o">=</span> <span class="n">get_longest_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alternate_path</span> <span class="o">=</span> <span class="n">get_longest_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">alternate_path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">seed_edge</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">alternate_path</span></div>

<div class="viewcode-block" id="get_branches"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.get_branches">[docs]</a><span class="k">def</span> <span class="nf">get_branches</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">branches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">seed_edge</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_longest_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">seed_edge</span><span class="p">)</span>
    <span class="n">branches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">upcoming_evaluations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">upcoming_evaluations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">upcoming_evaluations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#print(upcoming_evaluations)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">upcoming_evaluations</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">15</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">upcoming_evaluations</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">16</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">upcoming_evaluations</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">counter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">counter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">counter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counter</span><span class="p">))):</span>
                    <span class="k">if</span> <span class="n">counter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="k">break</span>
            <span class="k">continue</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_alternate_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">upcoming_evaluations</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">reference</span><span class="o">=</span><span class="n">branches</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">counter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">counter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">counter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counter</span><span class="p">))):</span>
                <span class="k">if</span> <span class="n">counter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>
        <span class="n">branches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">upcoming_evaluations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">counter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">branches</span></div>

<div class="viewcode-block" id="get_points"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.get_points">[docs]</a><span class="k">def</span> <span class="nf">get_points</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">):</span>
    <span class="n">path_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">primed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">:</span>
        <span class="n">branch_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">edge</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">primed</span><span class="p">:</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">edge</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">edge</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">primed</span><span class="p">:</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">three_fourths</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="c1">#new</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">three_fourths</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="c1">#new</span>
                <span class="n">mid_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mid_point</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">one_fourth</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="c1">#new</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">one_fourth</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="c1">#new</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">primed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">branch_points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">three_fourths</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="c1">#new</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">three_fourths</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="c1">#new</span>
                <span class="n">mid_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mid_point</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">one_fourth</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="c1">#new</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">one_fourth</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="c1">#new</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">three_fourths</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="c1">#new</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">three_fourths</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="c1">#new</span>
                <span class="n">mid_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mid_point</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">one_fourth</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="c1">#new</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">one_fourth</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="c1">#new</span>
        <span class="n">path_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch_points</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_points</span></div>

<div class="viewcode-block" id="get_points_v1"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.get_points_v1">[docs]</a><span class="k">def</span> <span class="nf">get_points_v1</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">):</span>
    <span class="n">path_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">primed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">:</span>
        <span class="n">branch_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">edge</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">edge</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">edge</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">primed</span><span class="p">:</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">primed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">branch_points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">path_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch_points</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_points</span></div>

<div class="viewcode-block" id="get_radii"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.get_radii">[docs]</a><span class="k">def</span> <span class="nf">get_radii</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">):</span>
    <span class="n">path_radii</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">primed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">:</span>
        <span class="n">branch_radii</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">edge</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">primed</span><span class="p">:</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">21</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">edge</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">edge</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">primed</span><span class="p">:</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span> <span class="c1">#new</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span> <span class="c1">#new</span>
                <span class="n">primed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">branch_radii</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span> <span class="c1">#new</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span> <span class="c1">#new</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span> <span class="c1">#new</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span> <span class="c1">#new</span>
        <span class="n">path_radii</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch_radii</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_radii</span></div>

<div class="viewcode-block" id="get_radii_v1"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.get_radii_v1">[docs]</a><span class="k">def</span> <span class="nf">get_radii_v1</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">):</span>
    <span class="n">path_radii</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">primed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">:</span>
        <span class="n">branch_radii</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">edge</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">edge</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">edge</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">primed</span><span class="p">:</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">]</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="n">previous</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span>
                <span class="n">primed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">branch_radii</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">21</span><span class="p">]</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="n">previous</span><span class="p">,</span><span class="mi">21</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="n">edge</span>
        <span class="n">path_radii</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch_radii</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_radii</span></div>

<div class="viewcode-block" id="get_normals"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.get_normals">[docs]</a><span class="k">def</span> <span class="nf">get_normals</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">):</span>
    <span class="n">path_normals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">primed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">:</span>
        <span class="n">branch_normals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">edge</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">primed</span><span class="p">:</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">edge</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">edge</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">primed</span><span class="p">:</span>
                <span class="n">vector_1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
                <span class="n">mid_vector</span> <span class="o">=</span> <span class="p">(</span><span class="n">vector_1</span><span class="o">+</span><span class="n">vector_2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mid_vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="c1">#new</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="c1">#new</span>
                <span class="n">primed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">branch_normals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="c1">#new</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="c1">#new</span>
                <span class="n">vector_2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vector_1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
                <span class="n">mid_vector</span> <span class="o">=</span> <span class="p">(</span><span class="n">vector_1</span><span class="o">+</span><span class="n">vector_2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mid_vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="c1">#new</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="c1">#new</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">vector_2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
        <span class="n">path_normals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch_normals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_normals</span></div>

<div class="viewcode-block" id="get_normals_v1"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.get_normals_v1">[docs]</a><span class="k">def</span> <span class="nf">get_normals_v1</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">):</span>
    <span class="n">path_normals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">primed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">:</span>
        <span class="n">branch_normals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">edge</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">edge</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">edge</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">primed</span><span class="p">:</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,((</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="n">previous</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">primed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">branch_normals</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,((</span><span class="n">data</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="n">previous</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="n">edge</span>
        <span class="n">path_normals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch_normals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_normals</span></div>

<div class="viewcode-block" id="plot_sv_data"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.plot_sv_data">[docs]</a><span class="k">def</span> <span class="nf">plot_sv_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">branches</span> <span class="o">=</span> <span class="n">get_branches</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">points</span>   <span class="o">=</span> <span class="n">get_points</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">)</span>
    <span class="n">radii</span>    <span class="o">=</span> <span class="n">get_radii</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">)</span>
    <span class="n">normals</span>  <span class="o">=</span> <span class="n">get_normals</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span><span class="n">tmp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">tmp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">tmp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">tmp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">tmp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">tmp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="get_interpolated_sv_data"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.get_interpolated_sv_data">[docs]</a><span class="k">def</span> <span class="nf">get_interpolated_sv_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">branches</span> <span class="o">=</span> <span class="n">get_branches</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">points</span>   <span class="o">=</span> <span class="n">get_points</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">)</span>
    <span class="c1">#print(&quot;Points: {}&quot;.format(points[0]))</span>
    <span class="n">radii</span>    <span class="o">=</span> <span class="n">get_radii</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">)</span>
    <span class="c1">#print(&quot;Radii:  {}&quot;.format(radii[0]))</span>
    <span class="n">normals</span>  <span class="o">=</span> <span class="n">get_normals</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">)</span>
    <span class="n">path_frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">branches</span><span class="p">)):</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">jdx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">])):</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">jdx</span><span class="p">])</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radii</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">jdx</span><span class="p">])</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">normals</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">jdx</span><span class="p">])</span>
            <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">path_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
    <span class="n">interp_xyz</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">interp_r</span>   <span class="o">=</span> <span class="p">[]</span>
    <span class="n">interp_n</span>   <span class="o">=</span> <span class="p">[]</span>
    <span class="n">interp_xyzr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">branches</span><span class="p">)):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">radii</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">normals</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">interp_xyz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">interp_xyz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">r</span><span class="p">))</span>
            <span class="n">interp_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">xyzr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">p</span><span class="p">,</span><span class="n">r</span><span class="p">))</span>
            <span class="n">interp_xyzr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">xyzr</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="c1">#interp_n.append(splprep(n,k=1,s=0))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">interp_xyz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">interp_xyz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">r</span><span class="p">))</span>
            <span class="n">interp_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">xyzr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">p</span><span class="p">,</span><span class="n">r</span><span class="p">))</span>
            <span class="n">interp_xyzr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">xyzr</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="c1">#interp_n.append(splprep(n,k=2,s=0))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">interp_xyz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">interp_xyz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">r</span><span class="p">))</span>
            <span class="n">interp_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">xyzr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">p</span><span class="p">,</span><span class="n">r</span><span class="p">))</span>
            <span class="n">interp_xyzr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">xyzr</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="c1">#interp_n.append(splprep(n,s=0))</span>

    <span class="k">return</span> <span class="n">interp_xyz</span><span class="p">,</span><span class="n">interp_r</span><span class="p">,</span><span class="n">interp_n</span><span class="p">,</span><span class="n">path_frames</span><span class="p">,</span><span class="n">branches</span><span class="p">,</span><span class="n">interp_xyzr</span></div>

<div class="viewcode-block" id="get_sv_data"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.get_sv_data">[docs]</a><span class="k">def</span> <span class="nf">get_sv_data</span><span class="p">(</span><span class="n">network</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">network</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="n">data</span>     <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">data</span>
        <span class="n">branches</span> <span class="o">=</span> <span class="n">get_branches</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">points</span>   <span class="o">=</span> <span class="n">get_points</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">)</span>
        <span class="n">radii</span>    <span class="o">=</span> <span class="n">get_radii</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">)</span>
        <span class="n">normals</span>  <span class="o">=</span> <span class="n">get_normals</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">network</span><span class="p">,</span><span class="n">forest</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">grafts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">grafts</span><span class="p">):</span>
            <span class="n">data</span>        <span class="o">=</span> <span class="p">[]</span>
            <span class="n">branches</span>    <span class="o">=</span> <span class="p">[]</span>
            <span class="n">connections</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">jdx</span><span class="p">,</span> <span class="n">graft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grafts</span><span class="p">):</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graft</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="n">branches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_branches</span><span class="p">(</span><span class="n">graft</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
                <span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">jdx</span><span class="p">])</span></div>

<div class="viewcode-block" id="plot_interp_vessels"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.plot_interp_vessels">[docs]</a><span class="k">def</span> <span class="nf">plot_interp_vessels</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">interp_r</span><span class="p">,</span><span class="n">normals</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax1</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="c1">#ax2  = fig.add_subplot(232,projection=&#39;3d&#39;)</span>
    <span class="c1">#ax3  = fig.add_subplot(233,projection=&#39;3d&#39;)</span>
    <span class="c1">#ax4  = fig.add_subplot(234,projection=&#39;3d&#39;)</span>
    <span class="c1">#ax5  = fig.add_subplot(235,projection=&#39;3d&#39;)</span>
    <span class="c1">#ax6  = fig.add_subplot(236,projection=&#39;3d&#39;)</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">nxx</span><span class="p">,</span><span class="n">nyy</span><span class="p">,</span><span class="n">nzz</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">inerp_xyz</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1">#nxxx,nyyy,nzzz,_,_,_,_ = splev(n,b[0],der=3)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="c1">#ax2.plot3D(x,y,z,c=&#39;b&#39;)</span>
        <span class="c1">#ax3.plot3D(x,y,z,c=&#39;b&#39;)</span>
        <span class="n">idx_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nx</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">idx_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ny</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">idx_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nz</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx_x</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">idx_x</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">idx_x</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx_y</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">idx_y</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">idx_y</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx_z</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">idx_z</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">idx_z</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">idx_xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nxx</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">idx_yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nyy</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">idx_zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nzz</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx_xx</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">idx_xx</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">idx_xx</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx_yy</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">idx_yy</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">idx_yy</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx_zz</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">idx_zz</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">idx_zz</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">nxxx</span><span class="p">,</span><span class="n">nyyy</span><span class="p">,</span><span class="n">nzzz</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">idx_xxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nxxx</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">idx_yyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nyyy</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">idx_zzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nzzz</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx_xxx</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">idx_xxx</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">idx_xxx</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx_yyy</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">idx_yyy</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">idx_yyy</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx_zzz</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">idx_zzz</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">idx_zzz</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="c1">#ax.plot3D(x,y,z)</span>
        <span class="c1">#x_knot,y_knot,z_knot,_,_,_,_ = splev(b[1],b[0])</span>
        <span class="c1">#ax.plot3D(x_knot,y_knot,z_knot,&#39;go&#39;)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if normals:</span>
<span class="sd">            nx = -1/nx</span>
<span class="sd">            ny = -1/ny</span>
<span class="sd">            nz = -1/nz</span>
<span class="sd">            l  = np.linalg.norm(np.array([nx,ny,nz]),axis=0)</span>
<span class="sd">            nx = (nx/l)*r</span>
<span class="sd">            ny = (ny/l)*r</span>
<span class="sd">            nz = (nz/l)*r</span>
<span class="sd">            points0 = np.array([x,y,z]).T.reshape(-1,1,3)</span>
<span class="sd">            points1 = np.array([x+nx,y+ny,z+nz]).T.reshape(-1,1,3)</span>
<span class="sd">            segments = np.concatenate([points0,points1],axis=1)</span>
<span class="sd">            lc = Line3DCollection(segments,color=&#39;black&#39;)</span>
<span class="sd">            ax.add_collection3d(lc)</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Point3D</span><span class="p">,</span><span class="n">Line3D</span><span class="p">,</span><span class="n">Plane</span><span class="p">,</span><span class="n">Float</span>
<div class="viewcode-block" id="contour_collision"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.contour_collision">[docs]</a><span class="k">def</span> <span class="nf">contour_collision</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">nx1</span><span class="p">,</span><span class="n">ny1</span><span class="p">,</span><span class="n">nz1</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz2</span><span class="p">,</span><span class="n">r2</span><span class="p">,</span><span class="n">radius_buffer</span><span class="p">,</span><span class="n">contours</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">n_sides</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    d1 = x1*nx1+y1*ny1+z1*nz1</span>
<span class="sd">    d2 = x2*nx2+y2*ny2+z2*nz2</span>
<span class="sd">    length = ((x2-x1)**2+(y2-y1)**2+(z2-z1)**2)**(1/2)</span>
<span class="sd">    if radius_buffer is not None:</span>
<span class="sd">        r1 += radius_buffer*r1</span>
<span class="sd">        r2 += radius_buffer*r2</span>
<span class="sd">    if not np.isclose(nx1,0):</span>
<span class="sd">        alpha = (nz1*nx2-nz2*nx1)/(ny2*nx1-ny1*nx2)</span>
<span class="sd">        beta  = (d1*nx2-d2*nx1)/(ny2*nx1-ny1*nx2)</span>
<span class="sd">        c     = ny1/nx1</span>
<span class="sd">        a_pt  = np.array([-d1/nx1-beta*c,beta,0])</span>
<span class="sd">        pt1   = np.array([x1,y1,z1])</span>
<span class="sd">        pt2   = np.array([x2,y2,z2])</span>
<span class="sd">        n_line= np.array([-(alpha*c+nz1/nx1),alpha,1])</span>
<span class="sd">        n_line=n_line/np.linalg.norm(n_line)</span>
<span class="sd">        dist1 = np.linalg.norm((pt1-a_pt)-np.dot(pt1-a_pt,n_line)*n_line)</span>
<span class="sd">        dist2 = np.linalg.norm((pt2-a_pt)-np.dot(pt2-a_pt,n_line)*n_line)</span>
<span class="sd">        print(&#39;dist1: {} r1: {}&#39;.format(dist1,r1))</span>
<span class="sd">        print(&#39;dist2: {} r2: {}&#39;.format(dist2,r2))</span>
<span class="sd">        if dist1 &lt; r1 or dist2 &lt; r2:</span>
<span class="sd">            return True</span>
<span class="sd">        else:</span>
<span class="sd">            return False</span>
<span class="sd">    elif not np.isclose(ny1,0):</span>
<span class="sd">        alpha = (nz1*ny2-nz2*ny1)/(nx2*ny1-nx1*ny2)</span>
<span class="sd">        beta  = (d1*ny2-d2*ny1)/(nx2*ny1-nx1*ny2)</span>
<span class="sd">        c     = nx1/ny1</span>
<span class="sd">        a_pt  = np.array([beta,-d1/ny1-beta*c,0])</span>
<span class="sd">        pt1   = np.array([x1,y1,z1])</span>
<span class="sd">        pt2   = np.array([x2,y2,z2])</span>
<span class="sd">        n_line= np.array([alpha,-(alpha*c+nz1/ny1),1])</span>
<span class="sd">        n_line=n_line/np.linalg.norm(n_line)</span>
<span class="sd">        dist1 = np.linalg.norm((pt1-a_pt)-np.dot(pt1-a_pt,n_line)*n_line)</span>
<span class="sd">        dist2 = np.linalg.norm((pt2-a_pt)-np.dot(pt2-a_pt,n_line)*n_line)</span>
<span class="sd">        print(&#39;dist1: {} r1: {}&#39;.format(dist1,r1))</span>
<span class="sd">        print(&#39;dist2: {} r2: {}&#39;.format(dist2,r2))</span>
<span class="sd">        if dist1 &lt; r1 or dist2 &lt; r2:</span>
<span class="sd">            return True</span>
<span class="sd">        else:</span>
<span class="sd">            return False</span>
<span class="sd">    else:</span>
<span class="sd">        return None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span>
    <span class="n">length</span> <span class="o">=</span> <span class="p">((</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">z2</span><span class="o">-</span><span class="n">z1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">radius_buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r1</span> <span class="o">+=</span> <span class="n">r1</span><span class="o">*</span><span class="n">radius_buffer</span>
        <span class="n">r2</span> <span class="o">+=</span> <span class="n">r2</span><span class="o">*</span><span class="n">radius_buffer</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    contour_1 = vtk.vtkRegularPolygonSource()</span>
<span class="sd">    contour_2 = vtk.vtkRegularPolygonSource()</span>
<span class="sd">    contour_1.SetCenter([x1,y1,z1])</span>
<span class="sd">    contour_2.SetCenter([x2,y2,z2])</span>
<span class="sd">    contour_1.SetRadius(r1)</span>
<span class="sd">    contour_2.SetRadius(r2)</span>
<span class="sd">    contour_1.SetNormal([nx1,ny1,nz1])</span>
<span class="sd">    contour_2.SetNormal([nx2,ny2,nz2])</span>
<span class="sd">    contour_1.SetNumberOfSides(n_sides)</span>
<span class="sd">    contour_2.SetNumberOfSides(n_sides)</span>
<span class="sd">    contour_11 = vtk.vtkContourTriangulator()</span>
<span class="sd">    contour_22 = vtk.vtkContourTriangulator()</span>
<span class="sd">    contour_11.SetInputConnection(contour_1.GetOutputPort())</span>
<span class="sd">    contour_22.SetInputConnection(contour_2.GetOutputPort())</span>
<span class="sd">    collision = vtk.vtkCollisionDetectionFilter()</span>
<span class="sd">    collision.SetInputConnection(0,contour_11.GetOutputPort())</span>
<span class="sd">    collision.SetInputConnection(1,contour_22.GetOutputPort())</span>
<span class="sd">    transform = vtk.vtkTransform()</span>
<span class="sd">    matrix = vtk.vtkMatrix4x4()</span>
<span class="sd">    collision.SetTransform(0,transform)</span>
<span class="sd">    collision.SetMatrix(1,matrix)</span>
<span class="sd">    collision.SetCollisionModeToAllContacts()</span>
<span class="sd">    collision.GenerateScalarsOn()</span>
<span class="sd">    collision.Update()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contour_1</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Disc</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">],</span><span class="n">inner</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">outer</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span><span class="n">normal</span><span class="o">=</span><span class="p">[</span><span class="n">nx1</span><span class="p">,</span><span class="n">ny1</span><span class="p">,</span><span class="n">nz1</span><span class="p">],</span><span class="n">r_res</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">c_res</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">triangulate</span><span class="p">()</span>
    <span class="n">contour_2</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Disc</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">],</span><span class="n">inner</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">outer</span><span class="o">=</span><span class="n">r2</span><span class="p">,</span><span class="n">normal</span><span class="o">=</span><span class="p">[</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz2</span><span class="p">],</span><span class="n">r_res</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">c_res</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">triangulate</span><span class="p">()</span>
    <span class="n">collision</span><span class="p">,</span><span class="n">ncol</span> <span class="o">=</span> <span class="n">contour_1</span><span class="o">.</span><span class="n">collision</span><span class="p">(</span><span class="n">contour_2</span><span class="p">,</span><span class="n">contact_mode</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1">#if collision.GetNumberOfContacts() &gt; 0:</span>
    <span class="k">if</span> <span class="n">ncol</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        actors = []</span>
<span class="sd">        colors = vtk.vtkNamedColors()</span>
<span class="sd">        mapper_1 = vtk.vtkPolyDataMapper()</span>
<span class="sd">        mapper_2 = vtk.vtkPolyDataMapper()</span>
<span class="sd">        actor_1 = vtk.vtkActor()</span>
<span class="sd">        actor_2 = vtk.vtkActor()</span>
<span class="sd">        mapper_1.SetInputConnection(contour_11.GetOutputPort())</span>
<span class="sd">        mapper_2.SetInputConnection(contour_22.GetOutputPort())</span>
<span class="sd">        actor_1.SetMapper(mapper_1)</span>
<span class="sd">        actor_2.SetMapper(mapper_2)</span>
<span class="sd">        actor_1.GetProperty().SetColor(colors.GetColor3d(&#39;blue&#39;))</span>
<span class="sd">        actor_2.GetProperty().SetColor(colors.GetColor3d(&#39;blue&#39;))</span>
<span class="sd">        actors.append(actor_1)</span>
<span class="sd">        actors.append(actor_2)</span>
<span class="sd">        renderer = vtk.vtkRenderer()</span>
<span class="sd">        renderer.SetBackground(colors.GetColor3d(&#39;white&#39;))</span>

<span class="sd">        render_window = vtk.vtkRenderWindow()</span>
<span class="sd">        render_window.AddRenderer(renderer)</span>
<span class="sd">        render_window.SetWindowName(&#39;Pathline with Contours&#39;)</span>

<span class="sd">        interactor = vtk.vtkRenderWindowInteractor()</span>
<span class="sd">        interactor.SetRenderWindow(render_window)</span>
<span class="sd">        for actor in actors:</span>
<span class="sd">            renderer.AddActor(actor)</span>
<span class="sd">        render_window.Render()</span>
<span class="sd">        interactor.Start()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    #print(&#39;{},{},{}&#39;.format(x1,y1,z1))</span>
<span class="sd">    p1 = Point3D(Float(x1),Float(y1),Float(z1))</span>
<span class="sd">    p2 = Point3D(Float(x2),Float(y2),Float(z2))</span>
<span class="sd">    a = Plane(p1,normal_vector=(Float(nx1),Float(ny1),Float(nz1)))</span>
<span class="sd">    b = Plane(p2,normal_vector=(Float(nx2),Float(ny2),Float(nz2)))</span>
<span class="sd">    intersect = a.intersection(b)[0]</span>
<span class="sd">    dist1 = intersect.distance(p1)</span>
<span class="sd">    dist2 = intersect.distance(p2)</span>
<span class="sd">    p_seg1 = intersect.perpendicular_line(p1)</span>
<span class="sd">    p_seg2 = intersect.perpendicular_line(p2)</span>
<span class="sd">    pi1 = intersect.intersection(p_seg1)[0]</span>
<span class="sd">    pi2 = intersect.intersection(p_seg2)[0]</span>
<span class="sd">    line_1 = np.array([[p1.x,p1.y,p1.z],[pi1.x,pi1.y,pi1.z]])</span>
<span class="sd">    line_2 = np.array([[p2.x,p2.y,p2.z],[pi2.x,pi2.y,pi2.z]])</span>
<span class="sd">    n1_vec = np.array([[p1.x,p1.y,p1.z],[p1.x+nx1,p1.y+ny1,p1.z+nz1]])</span>
<span class="sd">    n2_vec = np.array([[p2.x,p2.y,p2.z],[p2.x+nx2,p2.y+ny2,p2.z+nz2]])</span>
<span class="sd">    #print(&#39;dist1: {} r1: {}&#39;.format(dist1,r1))</span>
<span class="sd">    #print(&#39;dist2: {} r2: {}&#39;.format(dist2,r2))</span>
<span class="sd">    if dist1 &lt; r1 or dist2 &lt; r2:</span>
<span class="sd">        return True</span>
<span class="sd">    else:</span>
<span class="sd">        return False</span>
<span class="sd">    &quot;&quot;&quot;</span></div>
<div class="viewcode-block" id="contour_check"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.contour_check">[docs]</a><span class="k">def</span> <span class="nf">contour_check</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">interp_r</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">radius_buffer</span><span class="p">,</span><span class="n">n_sides</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">tl</span>  <span class="o">=</span> <span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span>
    <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">r1</span>      <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1">#_,r1            = splev(t0,interp_r[0])</span>
    <span class="n">nx1</span><span class="p">,</span><span class="n">ny1</span><span class="p">,</span><span class="n">nz1</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">n1</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx1</span><span class="p">,</span><span class="n">ny1</span><span class="p">,</span><span class="n">nz1</span><span class="p">])</span>
    <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">n1</span><span class="o">/</span><span class="n">mag</span>
    <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span><span class="n">r2</span>            <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1">#_,r2                  = splev(t1,interp_r[0])</span>
    <span class="n">nx2</span><span class="p">,</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz2</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">n2</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz2</span><span class="p">])</span>
    <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="n">n2</span><span class="o">/</span><span class="n">mag</span>
    <span class="n">collision</span> <span class="o">=</span> <span class="n">contour_collision</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz2</span><span class="p">,</span><span class="n">r2</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">nx1</span><span class="p">,</span><span class="n">ny1</span><span class="p">,</span><span class="n">nz1</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">radius_buffer</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">n_sides</span><span class="o">=</span><span class="n">n_sides</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">collision</span></div>

<div class="viewcode-block" id="contour_check_all"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.contour_check_all">[docs]</a><span class="k">def</span> <span class="nf">contour_check_all</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">interp_r</span><span class="p">,</span><span class="n">radius_buffer</span><span class="p">):</span>
    <span class="n">ANGLE_THRESHOLD</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">sample_t</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#n = np.linspace(0,1,1000)</span>
    <span class="n">desc1</span> <span class="o">=</span> <span class="s1">&#39;Extracting Loft Contours&#39;</span>
    <span class="n">desc1</span> <span class="o">=</span> <span class="n">desc1</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">40</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">desc1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">kdx</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">)),</span><span class="n">bar_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{l_bar}{bar:10}{r_bar}{bar:-10b}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">desc</span><span class="o">=</span><span class="n">desc1</span><span class="p">):</span>
        <span class="n">tmp_t</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">t_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">t_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1">#plot_path_contours(interp_xyz[kdx],interp_r[kdx],t_list)</span>
        <span class="n">normal_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">r</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">r</span><span class="p">]</span>
        <span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">normal</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">])</span>
        <span class="n">normal</span>     <span class="o">=</span> <span class="n">normal</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
        <span class="n">normal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
        <span class="c1"># Clean out all contours that provide little information</span>
        <span class="n">tmp_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">desc2</span> <span class="o">=</span> <span class="s1">&#39;Cleaning Out Redundant Contours&#39;</span>
        <span class="n">desc2</span> <span class="o">=</span> <span class="n">desc2</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">40</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">desc2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">t_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">bar_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{l_bar}{bar:10}{r_bar}{bar:-10b}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">desc</span><span class="o">=</span><span class="n">desc2</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">r</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">normal</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">])</span>
            <span class="n">normal</span>     <span class="o">=</span> <span class="n">normal</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
            <span class="n">angle</span>      <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">normal_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">normal</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="p">)</span>
            <span class="n">dist</span>       <span class="o">=</span> <span class="p">((</span><span class="n">previous</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">previous</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">previous</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="n">ANGLE_THRESHOLD</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dist</span><span class="o">&gt;</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="n">previous</span><span class="p">[</span><span class="mi">3</span><span class="p">])):</span>
                <span class="n">normal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
                <span class="n">tmp_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
                <span class="n">previous</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">r</span><span class="p">]</span>
        <span class="n">tmp_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1">#plot_path_contours(interp_xyz[kdx],interp_r[kdx],tmp_t)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if len(tmp_t) &gt; 2:</span>
<span class="sd">            tmp_tmp_t = [tmp_t[0]]</span>
<span class="sd">            for ct in tqdm(tmp_t[1:-1],position=2,desc=&quot;Cleaning Consecutive Colliding Contours&quot;):</span>
<span class="sd">                _,_,_,r = splev(ct,interp_xyz[kdx][0])</span>
<span class="sd">                if contour_check(interp_xyz[kdx],interp_r[kdx],tmp_tmp_t[-1],ct,r*0.25,n_sides=20):</span>
<span class="sd">                    if len(tmp_tmp_t) &gt; 1:</span>
<span class="sd">                        tmp_tmp_t[-1] = (ct+tmp_tmp_t[-1])/2</span>
<span class="sd">                else:</span>
<span class="sd">                    tmp_tmp_t.append(ct)</span>
<span class="sd">            tmp_tmp_t.append(tmp_t[-1])</span>
<span class="sd">        else:</span>
<span class="sd">            tmp_tmp_t = tmp_t</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmp_tmp_t</span> <span class="o">=</span> <span class="n">tmp_t</span>
        <span class="c1">#plot_path_contours(interp_xyz[kdx],interp_r[kdx],tmp_tmp_t)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">tmp_tmp_tmp_t</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp_tmp_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">desc3</span> <span class="o">=</span> <span class="s1">&#39;Cleaning remaining collisions&#39;</span>
            <span class="n">desc3</span> <span class="o">=</span> <span class="n">desc3</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">40</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">desc3</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">tmp_tmp_t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">bar_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{l_bar}{bar:10}{r_bar}{bar:-10b}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">desc</span><span class="o">=</span><span class="n">desc3</span><span class="p">):</span>
                <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">r</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">include</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">cct</span> <span class="ow">in</span> <span class="n">tmp_tmp_t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">cct</span><span class="o">==</span><span class="n">ct</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">contour_check</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span><span class="n">interp_r</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span><span class="n">ct</span><span class="p">,</span><span class="n">cct</span><span class="p">,</span><span class="n">r</span><span class="o">*</span><span class="mf">0.25</span><span class="p">,</span><span class="n">n_sides</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
                        <span class="n">include</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">include</span><span class="p">:</span>
                    <span class="n">tmp_tmp_tmp_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
            <span class="n">tmp_tmp_tmp_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmp_tmp_tmp_t</span> <span class="o">=</span> <span class="n">tmp_tmp_t</span>
        <span class="c1">#plot_path_contours(interp_xyz[kdx],interp_r[kdx],tmp_tmp_tmp_t)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_tmp_t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">repeat</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">old_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_tmp_tmp_t</span><span class="p">)</span>
            <span class="n">resample_count</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">repeat</span><span class="p">:</span>
                <span class="n">tmp_tmp_tmp_tmp_t</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp_tmp_tmp_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">normal_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">normal</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">])</span>
                <span class="n">normal</span>     <span class="o">=</span> <span class="n">normal</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
                <span class="n">normal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
                <span class="n">highlight</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">swap_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_tmp_tmp_t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">desc4</span> <span class="o">=</span> <span class="s1">&#39;Resampling </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resample_count</span><span class="p">)</span>
                <span class="n">desc4</span> <span class="o">=</span> <span class="n">desc4</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">40</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">desc4</span><span class="p">))</span>
                <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span><span class="n">bar_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{l_bar}{bar:10}{r_bar}{bar:-10b}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">desc</span><span class="o">=</span><span class="n">desc4</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">ct_idx</span><span class="p">,</span><span class="n">ct</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tmp_tmp_tmp_t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">t_next</span> <span class="o">=</span> <span class="n">tmp_tmp_tmp_t</span><span class="p">[</span><span class="n">ct_idx</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
                        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">r</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">normal</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">])</span>
                        <span class="n">normal</span>     <span class="o">=</span> <span class="n">normal</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
                        <span class="n">angle</span>      <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">normal_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">normal</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="n">ANGLE_THRESHOLD</span><span class="o">+</span><span class="mi">5</span><span class="p">:</span>
                            <span class="n">t_op</span><span class="p">,</span><span class="n">f_op</span> <span class="o">=</span> <span class="n">optimize_contour</span><span class="p">(</span><span class="n">tmp_tmp_tmp_tmp_t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">ct</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span><span class="n">interp_r</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span><span class="mf">0.25</span><span class="p">,</span><span class="n">n_sides</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                            <span class="n">tnx</span><span class="p">,</span><span class="n">tny</span><span class="p">,</span><span class="n">tnz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t_op</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">next_nx</span><span class="p">,</span><span class="n">next_ny</span><span class="p">,</span><span class="n">next_nz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t_next</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">t_op_normal</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tnx</span><span class="p">,</span><span class="n">tny</span><span class="p">,</span><span class="n">tnz</span><span class="p">])</span>
                            <span class="n">t_op_normal</span>     <span class="o">=</span> <span class="n">t_op_normal</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t_op_normal</span><span class="p">)</span>
                            <span class="n">angle0</span>      <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">normal_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">t_op_normal</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="p">)</span>
                            <span class="n">t_next_normal</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">next_nx</span><span class="p">,</span><span class="n">next_ny</span><span class="p">,</span><span class="n">next_nz</span><span class="p">])</span>
                            <span class="n">t_next_normal</span>     <span class="o">=</span> <span class="n">t_next_normal</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t_next_normal</span><span class="p">)</span>
                            <span class="n">angle1</span>      <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">t_op_normal</span><span class="p">,</span><span class="n">t_next_normal</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">f_op</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">angle0</span> <span class="o">&gt;</span> <span class="n">ANGLE_THRESHOLD</span><span class="o">*</span><span class="mf">0.5</span> <span class="ow">and</span> <span class="n">angle1</span> <span class="o">&gt;</span> <span class="n">ANGLE_THRESHOLD</span><span class="o">*</span><span class="mf">0.5</span><span class="p">):</span>
                                <span class="c1">#t_op = (tmp_tmp_tmp_t[-1]+ct)/2</span>
                                <span class="n">tmp_tmp_tmp_tmp_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_op</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">count</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_tmp_tmp_t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                    <span class="n">swap_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">count</span><span class="o">-</span><span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">swap_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                                <span class="n">highlight</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">tmp_tmp_tmp_tmp_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">tmp_tmp_tmp_tmp_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">normal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
                        <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">tmp_tmp_tmp_tmp_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_tmp_t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">#plot_path_contours(interp_xyz[kdx],interp_r[kdx],tmp_tmp_tmp_tmp_t,highlight=highlight)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_tmp_tmp_tmp_t</span><span class="p">)</span> <span class="o">==</span> <span class="n">old_count</span><span class="p">:</span>
                    <span class="n">repeat</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="c1">#else:</span>
                <span class="c1">#    better_t,better_idx = swap_contour(interp_xyz[kdx],tmp_tmp_tmp_tmp_t,0.25)</span>
                <span class="c1">#    tmp_tmp_tmp_tmp_t[better_idx] = better_t</span>
                <span class="c1">#    plot_path_contours(interp_xyz[kdx],interp_r[kdx],tmp_tmp_tmp_tmp_t,highlight=[better_idx])</span>
                <span class="k">for</span> <span class="n">sw</span> <span class="ow">in</span> <span class="n">swap_list</span><span class="p">:</span>
                    <span class="n">tmp_tmp_tmp_tmp_t</span><span class="p">[</span><span class="n">sw</span><span class="p">]</span> <span class="o">=</span> <span class="n">swap_contour</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span><span class="n">tmp_tmp_tmp_tmp_t</span><span class="p">,</span><span class="n">sw</span><span class="p">,</span><span class="mf">0.25</span><span class="p">)</span>
                <span class="c1">#plot_path_contours(interp_xyz[kdx],interp_r[kdx],tmp_tmp_tmp_tmp_t,highlight=swap_list)</span>
                <span class="n">tmp_tmp_tmp_tmp_t</span><span class="p">,</span><span class="n">better_idx</span> <span class="o">=</span> <span class="n">swap_worst_contour</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span><span class="n">tmp_tmp_tmp_tmp_t</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">ANGLE_THRESHOLD</span><span class="p">)</span>
                <span class="c1">#plot_path_contours(interp_xyz[kdx],interp_r[kdx],tmp_tmp_tmp_tmp_t,highlight=better_idx)</span>
                <span class="n">old_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_tmp_tmp_tmp_t</span><span class="p">)</span>
                <span class="n">tmp_tmp_tmp_t</span> <span class="o">=</span> <span class="n">tmp_tmp_tmp_tmp_t</span>
                <span class="n">resample_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmp_tmp_tmp_tmp_t</span> <span class="o">=</span> <span class="n">tmp_tmp_tmp_t</span>
        <span class="c1">#plot_path_contours(interp_xyz[kdx],interp_r[kdx],tmp_tmp_tmp_tmp_t,highlight=highlight)</span>
        <span class="n">sample_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_tmp_tmp_tmp_t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sample_t</span></div>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ORIGINAL CONTOUR CHECKING</span>
<span class="sd">def contour_check_all(interp_xyz,interp_r,radius_buffer):</span>
<span class="sd">    sample_t = []</span>
<span class="sd">    n = np.linspace(0,1,200)</span>
<span class="sd">    total_collisions = 0</span>
<span class="sd">    for kdx in tqdm(range(len(interp_xyz)),desc=&#39;Resolving Overlaps&#39;):</span>
<span class="sd">        tmp_t  = []</span>
<span class="sd">        t_list = []</span>
<span class="sd">        t_list = np.linspace(0,1,4*len(interp_xyz[kdx][1]))</span>
<span class="sd">        collision_contours = set([])</span>
<span class="sd">        collision_free = set([])</span>
<span class="sd">        checking = set(list(range(1,len(t_list)-1)))</span>
<span class="sd">        #t_op,f_op = optimize_contour(t_range[first],t_range[second],contours)</span>
<span class="sd">        for idx in checking:</span>
<span class="sd">            collide = False</span>
<span class="sd">            for jdx in checking.difference(set([idx])):</span>
<span class="sd">                if contour_check(interp_xyz[kdx],interp_r[kdx],t_list[idx],t_list[jdx],radius_buffer,n_sides=20):</span>
<span class="sd">                    collision_contours.add(idx)</span>
<span class="sd">                    collision_contours.add(jdx)</span>
<span class="sd">                    collide = True</span>
<span class="sd">                    break</span>
<span class="sd">            if not collide:</span>
<span class="sd">                collision_free.add(idx)</span>
<span class="sd">            #checking = checking.difference(collision_contours)</span>
<span class="sd">            checking = checking.difference(collision_free)</span>
<span class="sd">        collision_free = list(collision_free)</span>
<span class="sd">        collision_free.sort()</span>
<span class="sd">        if len(collision_contours) &gt; 0:</span>
<span class="sd">            pass</span>
<span class="sd">            plot_path_contours(interp_xyz[kdx],interp_r[kdx],t_list,highlight=list(collision_contours))</span>
<span class="sd">        tmp_t.append(t_list[0])</span>
<span class="sd">        for idx in range(len(collision_free)-1):</span>

<span class="sd">            if collision_free[idx+1] - collision_free[idx]&gt;1:</span>
<span class="sd">                tmp_tmp_t = [t_list[collision_free[idx]],t_list[collision_free[idx+1]]]</span>
<span class="sd">                #nx,ny,nz,_,_,_,_ = splev(tmp_tmp_t,contours,der=1)</span>
<span class="sd">                #normals = np.array([nx,ny,nz]).T</span>
<span class="sd">                #tmp_tmp_angles = [np.dot(normals[i,:],normals[i+1,:]) for i in range(normals.shape[0]-1)]</span>
<span class="sd">                for jdx in range(collision_free[idx+1] - collision_free[idx]):</span>
<span class="sd">                    #max_diff = np.argmax(np.diff(tmp_tmp_angles))</span>
<span class="sd">                    nx,ny,nz,_ = splev(tmp_tmp_t,interp_xyz[kdx][0],der=1)</span>
<span class="sd">                    normals = np.array([nx,ny,nz]).T</span>
<span class="sd">                    tmp_tmp_angles = [np.dot(normals[i,:],normals[i+1,:]) for i in range(normals.shape[0]-1)]</span>
<span class="sd">                    max_diff = np.argmin(tmp_tmp_angles)</span>
<span class="sd">                    t_op,f_op = optimize_contour(tmp_tmp_t[max_diff],tmp_tmp_t[max_diff+1],interp_xyz[kdx],interp_r[kdx],radius_buffer,n_sides=20)</span>
<span class="sd">                    if f_op &lt; 0:</span>
<span class="sd">                        tmp_tmp_t.append(t_op)</span>
<span class="sd">                        tmp_tmp_t.sort()</span>
<span class="sd">                    else:</span>
<span class="sd">                        break</span>
<span class="sd">                tmp_tmp_t.pop(-1)</span>
<span class="sd">                tmp_t.extend(tmp_tmp_t)</span>
<span class="sd">            else:</span>
<span class="sd">                tmp_t.append(t_list[collision_free[idx]])</span>
<span class="sd">        tmp_t.append(t_list[collision_free[-1]])</span>
<span class="sd">        tmp_t.append(t_list[-1])</span>
<span class="sd">        if len(collision_contours) &gt; 0:</span>
<span class="sd">            pass</span>
<span class="sd">            plot_path_contours(interp_xyz[kdx],interp_r[kdx],tmp_t)</span>
<span class="sd">        if len(tmp_t) == 1:</span>
<span class="sd">            tmp_t.append(1)</span>
<span class="sd">        else:</span>
<span class="sd">            tmp_t[-1] = 1</span>
<span class="sd">        sample_t.append(tmp_t)</span>
<span class="sd">    print(&#39;Total Collisions Resolved: &#39;+str(total_collisions))</span>
<span class="sd">    return sample_t</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="sv_data"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.sv_data">[docs]</a><span class="k">def</span> <span class="nf">sv_data</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">interp_r</span><span class="p">,</span><span class="n">radius_buffer</span><span class="o">=</span><span class="mf">0.25</span><span class="p">):</span>
    <span class="n">points</span>  <span class="o">=</span> <span class="p">[]</span>
    <span class="n">radii</span>   <span class="o">=</span> <span class="p">[]</span>
    <span class="n">normals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sample_t</span> <span class="o">=</span> <span class="n">contour_check_all</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">interp_r</span><span class="p">,</span><span class="n">radius_buffer</span><span class="p">)</span>
    <span class="c1">#fig = plt.figure()</span>
    <span class="c1">#ax = fig.add_subplot(111,projection=&#39;3d&#39;)</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">)):</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">r</span>    <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample_t</span><span class="p">[</span><span class="n">idx</span><span class="p">]),</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#_,r        = splev(np.array(sample_t[idx]),interp_r[idx][0])</span>
        <span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample_t</span><span class="p">[</span><span class="n">idx</span><span class="p">]),</span><span class="n">interp_xyz</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="n">nx</span><span class="o">/</span><span class="n">l</span>
        <span class="n">ny</span> <span class="o">=</span> <span class="n">ny</span><span class="o">/</span><span class="n">l</span>
        <span class="n">nz</span> <span class="o">=</span> <span class="n">nz</span><span class="o">/</span><span class="n">l</span>
        <span class="c1">#ax.plot3D(x,y,z)</span>
        <span class="c1">#for i in range(len(x)):</span>
        <span class="c1">#    patch = Circle((0,0),r[i],facecolor=&#39;r&#39;)</span>
        <span class="c1">#    ax.add_patch(patch)</span>
        <span class="c1">#    pathpatch_2d_to_3d(patch,z=0,normal=np.array([nx[i],ny[i],nz[i]]))</span>
        <span class="c1">#    pathpatch_translate(patch,(x[i],y[i],z[i]))</span>
        <span class="n">tmp_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">tmp_points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">tmp_points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">tmp_points</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_points</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">tmp_normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">nx</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">tmp_normals</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nx</span>
        <span class="n">tmp_normals</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ny</span>
        <span class="n">tmp_normals</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">nz</span>
        <span class="n">radii</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">normals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_normals</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="c1">#plt.show()</span>
    <span class="k">return</span> <span class="n">points</span><span class="p">,</span><span class="n">radii</span><span class="p">,</span><span class="n">normals</span></div>

<div class="viewcode-block" id="plot_frames"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.plot_frames">[docs]</a><span class="k">def</span> <span class="nf">plot_frames</span><span class="p">(</span><span class="n">frames</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frames</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">f</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">f</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="plot_branches"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.plot_branches">[docs]</a><span class="k">def</span> <span class="nf">plot_branches</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">branch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">branches</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">branch</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
                      <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">4</span><span class="p">]],</span>
                      <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">5</span><span class="p">]],</span><span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="plot_path_contours"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.plot_path_contours">[docs]</a><span class="k">def</span> <span class="nf">plot_path_contours</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">interp_r</span><span class="p">,</span><span class="n">t_list</span><span class="p">,</span><span class="n">highlight</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">disks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPoints</span><span class="p">()</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">radii</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">normals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">actors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkNamedColors</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_list</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">r</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#_,r     = splev(t,interp_r[0])</span>
        <span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">points</span><span class="o">.</span><span class="n">InsertNextPoint</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">])</span>
        <span class="n">radii</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">normals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">])</span>
        <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">])</span>
    <span class="n">polyline</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyLine</span><span class="p">()</span>
    <span class="n">polyline</span><span class="o">.</span><span class="n">GetPointIds</span><span class="p">()</span><span class="o">.</span><span class="n">SetNumberOfIds</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_list</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_list</span><span class="p">)):</span>
        <span class="n">polyline</span><span class="o">.</span><span class="n">GetPointIds</span><span class="p">()</span><span class="o">.</span><span class="n">SetId</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCellArray</span><span class="p">()</span>
    <span class="n">cells</span><span class="o">.</span><span class="n">InsertNextCell</span><span class="p">(</span><span class="n">polyline</span><span class="p">)</span>
    <span class="n">polydata</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyData</span><span class="p">()</span>
    <span class="n">polydata</span><span class="o">.</span><span class="n">SetPoints</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">polydata</span><span class="o">.</span><span class="n">SetLines</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
    <span class="n">mapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">()</span>
    <span class="n">actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
    <span class="n">mapper</span><span class="o">.</span><span class="n">SetInputDataObject</span><span class="p">(</span><span class="n">polydata</span><span class="p">)</span>
    <span class="n">actor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">mapper</span><span class="p">)</span>
    <span class="n">actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">GetColor3d</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">))</span>
    <span class="n">actors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">radii</span><span class="p">)):</span>
        <span class="n">tmp_disk</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkRegularPolygonSource</span><span class="p">()</span>
        <span class="n">tmp_disk</span><span class="o">.</span><span class="n">SetRadius</span><span class="p">(</span><span class="n">radii</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="n">tmp_disk</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="n">tmp_disk</span><span class="o">.</span><span class="n">SetNormal</span><span class="p">(</span><span class="n">normals</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="n">tmp_disk</span><span class="o">.</span><span class="n">SetNumberOfSides</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">mapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">()</span>
        <span class="n">actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
        <span class="n">mapper</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">tmp_disk</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
        <span class="n">actor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">mapper</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">highlight</span><span class="p">:</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">GetColor3d</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">GetColor3d</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">))</span>
        <span class="n">disks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_disk</span><span class="p">)</span>
        <span class="n">actors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
    <span class="n">renderer</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkRenderer</span><span class="p">()</span>
    <span class="n">renderer</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">GetColor3d</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>

    <span class="n">render_window</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkRenderWindow</span><span class="p">()</span>
    <span class="n">render_window</span><span class="o">.</span><span class="n">AddRenderer</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
    <span class="n">render_window</span><span class="o">.</span><span class="n">SetWindowName</span><span class="p">(</span><span class="s1">&#39;Pathline with Contours&#39;</span><span class="p">)</span>

    <span class="n">interactor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkRenderWindowInteractor</span><span class="p">()</span>
    <span class="n">interactor</span><span class="o">.</span><span class="n">SetRenderWindow</span><span class="p">(</span><span class="n">render_window</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">actor</span> <span class="ow">in</span> <span class="n">actors</span><span class="p">:</span>
        <span class="n">renderer</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
    <span class="n">render_window</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
    <span class="n">interactor</span><span class="o">.</span><span class="n">Start</span><span class="p">()</span></div>

<div class="viewcode-block" id="optimize_contour"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.optimize_contour">[docs]</a><span class="k">def</span> <span class="nf">optimize_contour</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">interp_r</span><span class="p">,</span><span class="n">radius_buffer</span><span class="p">,</span><span class="n">t_buffer</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">n_sides</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="n">nx0</span><span class="p">,</span><span class="n">ny0</span><span class="p">,</span><span class="n">nz0</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nx1</span><span class="p">,</span><span class="n">ny1</span><span class="p">,</span><span class="n">nz1</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">n0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx0</span><span class="p">,</span><span class="n">ny0</span><span class="p">,</span><span class="n">nz0</span><span class="p">])</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx1</span><span class="p">,</span><span class="n">ny1</span><span class="p">,</span><span class="n">nz1</span><span class="p">])</span>
    <span class="n">n0</span> <span class="o">=</span> <span class="n">n0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n0</span><span class="p">)</span> <span class="c1">#.reshape(-1,1)</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">n1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="c1">#.reshape(-1,1)</span>
    <span class="n">t_bound_buff</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="n">t_buffer</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">interp_xyz</span><span class="o">=</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">interp_r</span><span class="o">=</span><span class="n">interp_r</span><span class="p">,</span><span class="n">n0</span><span class="o">=</span><span class="n">n0</span><span class="p">,</span><span class="n">n1</span><span class="o">=</span><span class="n">n1</span><span class="p">,</span><span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="o">=</span><span class="n">t1</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">z0</span><span class="p">,</span><span class="n">r0</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">r1</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">r</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">])</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c1">#.reshape(-1,1)</span>
        <span class="c1">#print(-np.dot(n0,n)*np.dot(n1,n))</span>
        <span class="n">n_avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">n0</span><span class="o">+</span><span class="n">n1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n_avg</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
        <span class="n">first_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
        <span class="n">second_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
        <span class="c1">#l0 = ((x0-x)**(2)+(y0-y)**(2)+(z0-z)**(2))**(1/2)</span>
        <span class="c1">#l1 = ((x1-x)**(2)+(y1-y)**(2)+(z1-z)**(2))**(1/2)</span>
        <span class="n">mx</span>  <span class="o">=</span> <span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">x1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">my</span>  <span class="o">=</span> <span class="p">(</span><span class="n">y0</span><span class="o">+</span><span class="n">y1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">mz</span>  <span class="o">=</span> <span class="p">(</span><span class="n">z0</span><span class="o">+</span><span class="n">z1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">lm1</span> <span class="o">=</span> <span class="p">((</span><span class="n">x0</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">y0</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">z0</span><span class="o">-</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">lm2</span> <span class="o">=</span> <span class="p">((</span><span class="n">x1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">z1</span><span class="o">-</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1">#d   = (((x1-x0)**(2)+(y1-y0)**(2)+(z1-z0)**(2))**(1/2))/2</span>
        <span class="c1">#d   = d/2</span>
        <span class="n">lm</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lm1</span><span class="o">-</span><span class="n">lm2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">lm1</span><span class="o">+</span><span class="n">lm2</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">contour_check</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">interp_r</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">radius_buffer</span><span class="o">=</span><span class="n">radius_buffer</span><span class="p">,</span><span class="n">n_sides</span><span class="o">=</span><span class="n">n_sides</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="n">contour_check</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">interp_r</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">radius_buffer</span><span class="o">=</span><span class="n">radius_buffer</span><span class="p">,</span><span class="n">n_sides</span><span class="o">=</span><span class="n">n_sides</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">first_angle</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r0</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">lm1</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">second_angle</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">lm2</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="mi">100</span>
        <span class="c1">#return -(a*b+(1-abs(a-b))) + c # + abs(l0-l1)</span>
        <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">lm</span><span class="o">/</span><span class="mi">100</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">t_bound_buff</span><span class="p">,</span><span class="n">t1</span><span class="o">-</span><span class="n">t_bound_buff</span><span class="p">),</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;bounded&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span></div>

<div class="viewcode-block" id="swap_worst_contour"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.swap_worst_contour">[docs]</a><span class="k">def</span> <span class="nf">swap_worst_contour</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">t_list</span><span class="p">,</span><span class="n">radius_buffer</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">normal_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">normal</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">])</span>
    <span class="n">normal</span>     <span class="o">=</span> <span class="n">normal</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
    <span class="n">normal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
    <span class="c1">#next_nx,next_ny,next_nz,_ = splev(t_list[1],interp_xyz[kdx][0],der=1)</span>
    <span class="c1">#next_normal     = np.array([next_nx,next_ny,next_nz])</span>
    <span class="c1">#next_normal     = next_normal/np.linalg.norm(next_normal)</span>
    <span class="c1">#angle = abs((np.arccos(np.dot(normal_list[-1],next_normal.T))/np.pi)*180)</span>
    <span class="c1">#scores = [angle]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">desc5</span> <span class="o">=</span> <span class="s1">&#39;Computing swap scores&#39;</span>
    <span class="n">desc5</span> <span class="o">=</span> <span class="n">desc5</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">40</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">desc5</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span><span class="n">bar_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{l_bar}{bar:10}{r_bar}{bar:-10b}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">desc</span><span class="o">=</span><span class="n">desc5</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">ct</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">next_t</span>            <span class="o">=</span> <span class="n">t_list</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">_</span>        <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">normal</span>            <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">])</span>
            <span class="n">normal</span>            <span class="o">=</span> <span class="n">normal</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
            <span class="n">angle0</span>            <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">normal_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">normal</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="p">)</span>
            <span class="n">next_nx</span><span class="p">,</span><span class="n">next_ny</span><span class="p">,</span><span class="n">next_nz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">next_t</span><span class="p">,</span><span class="n">interp_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">der</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">t_next_normal</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">next_nx</span><span class="p">,</span><span class="n">next_ny</span><span class="p">,</span><span class="n">next_nz</span><span class="p">])</span>
            <span class="n">t_next_normal</span>     <span class="o">=</span> <span class="n">t_next_normal</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t_next_normal</span><span class="p">)</span>
            <span class="n">angle1</span>            <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="n">t_next_normal</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="p">)</span>
            <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle0</span><span class="o">+</span><span class="n">angle1</span><span class="p">)</span>
            <span class="n">normal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">worst_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">&gt;</span><span class="n">thresh</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">worst_idx</span> <span class="o">=</span> <span class="n">worst_idx</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">wi</span> <span class="ow">in</span> <span class="n">worst_idx</span><span class="p">:</span>
        <span class="n">t</span>   <span class="o">=</span> <span class="n">t_list</span><span class="p">[</span><span class="n">wi</span><span class="p">]</span>
        <span class="n">t0</span><span class="p">,</span><span class="n">f0</span> <span class="o">=</span> <span class="n">optimize_contour</span><span class="p">(</span><span class="n">t_list</span><span class="p">[</span><span class="n">wi</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">t_list</span><span class="p">[</span><span class="n">wi</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">interp_xyz</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">radius_buffer</span><span class="p">,</span><span class="n">t_buffer</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">n_sides</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f0</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">t_list</span><span class="p">[</span><span class="n">wi</span><span class="p">]</span> <span class="o">=</span> <span class="n">t0</span>
    <span class="k">return</span> <span class="n">t_list</span><span class="p">,</span><span class="n">worst_idx</span></div>

<div class="viewcode-block" id="swap_contour"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.swap_contour">[docs]</a><span class="k">def</span> <span class="nf">swap_contour</span><span class="p">(</span><span class="n">interp_xyz</span><span class="p">,</span><span class="n">t_list</span><span class="p">,</span><span class="n">c_idx</span><span class="p">,</span><span class="n">radius_buffer</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">t_list</span><span class="p">[</span><span class="n">c_idx</span><span class="p">]</span>
    <span class="n">t0</span><span class="p">,</span><span class="n">f0</span> <span class="o">=</span> <span class="n">optimize_contour</span><span class="p">(</span><span class="n">t_list</span><span class="p">[</span><span class="n">c_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">t_list</span><span class="p">[</span><span class="n">c_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">interp_xyz</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">radius_buffer</span><span class="p">,</span><span class="n">t_buffer</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">n_sides</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f0</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">t0</span>
    <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="truncate"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.truncate">[docs]</a><span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">indicies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">indicies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span><span class="mi">21</span><span class="p">])</span>
    <span class="n">branches</span> <span class="o">=</span> <span class="n">get_branches</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">include</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">exclude</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">:</span>
        <span class="n">tmp_include</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tmp_exclude</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">vdx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">branch</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">indicies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">vdx</span><span class="p">,</span><span class="mi">21</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">radius</span><span class="p">:</span>
                    <span class="n">tmp_include</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vdx</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp_exclude</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vdx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">vdx</span> <span class="ow">in</span> <span class="n">indicies</span><span class="p">:</span>
                    <span class="n">tmp_include</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vdx</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp_exclude</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vdx</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_include</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">include</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_include</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_exclude</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">exclude</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_exclude</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">include</span><span class="p">,</span> <span class="n">exclude</span></div>

<div class="viewcode-block" id="get_truncated_interpolated_sv_data"><a class="viewcode-back" href="../../../svcco.sv_interface.html#svcco.sv_interface.get_sv_data.get_truncated_interpolated_sv_data">[docs]</a><span class="k">def</span> <span class="nf">get_truncated_interpolated_sv_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">indicies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">branches</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">truncate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span><span class="n">indicies</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
    <span class="n">points</span>   <span class="o">=</span> <span class="n">get_points</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">)</span>
    <span class="c1">#print(&quot;Points: {}&quot;.format(points[0]))</span>
    <span class="n">radii</span>    <span class="o">=</span> <span class="n">get_radii</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">)</span>
    <span class="c1">#print(&quot;Radii:  {}&quot;.format(radii[0]))</span>
    <span class="n">normals</span>  <span class="o">=</span> <span class="n">get_normals</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">branches</span><span class="p">)</span>
    <span class="n">path_frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">branches</span><span class="p">)):</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">jdx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">])):</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">jdx</span><span class="p">])</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radii</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">jdx</span><span class="p">])</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">normals</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">jdx</span><span class="p">])</span>
            <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">path_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
    <span class="n">interp_xyz</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">interp_r</span>   <span class="o">=</span> <span class="p">[]</span>
    <span class="n">interp_n</span>   <span class="o">=</span> <span class="p">[]</span>
    <span class="n">interp_xyzr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">branches</span><span class="p">)):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">radii</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">normals</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">interp_xyz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">interp_xyz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">r</span><span class="p">))</span>
            <span class="n">interp_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">xyzr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">p</span><span class="p">,</span><span class="n">r</span><span class="p">))</span>
            <span class="n">interp_xyzr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">xyzr</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="c1">#interp_n.append(splprep(n,k=1,s=0))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">interp_xyz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">interp_xyz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">r</span><span class="p">))</span>
            <span class="n">interp_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">xyzr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">p</span><span class="p">,</span><span class="n">r</span><span class="p">))</span>
            <span class="n">interp_xyzr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">xyzr</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="c1">#interp_n.append(splprep(n,k=2,s=0))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">interp_xyz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">interp_xyz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">r</span><span class="p">))</span>
            <span class="n">interp_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">xyzr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">p</span><span class="p">,</span><span class="n">r</span><span class="p">))</span>
            <span class="n">interp_xyzr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splprep</span><span class="p">(</span><span class="n">xyzr</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="c1">#interp_n.append(splprep(n,s=0))</span>

    <span class="k">return</span> <span class="n">interp_xyz</span><span class="p">,</span><span class="n">interp_r</span><span class="p">,</span><span class="n">interp_n</span><span class="p">,</span><span class="n">path_frames</span><span class="p">,</span><span class="n">branches</span><span class="p">,</span><span class="n">interp_xyzr</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SVCCO 0.5.52 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">svcco.sv_interface.get_sv_data</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Zachary Sexton.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>